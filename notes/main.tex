
\documentclass{article}

\usepackage{hyperref}
\usepackage{parskip}
\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{graphviz}

\usepackage[backend=biber,autocite=footnote,
			bibstyle=authortitle,citestyle=verbose-inote]{biblatex}
\addbibresource{main.bib}
\setlength\bibitemsep{1em}

\usepackage{listings}
\lstset{numbers=left,
		float=htpb,
		language=Matlab,
		basicstyle=\footnotesize,
		captionpos=b,
		xleftmargin=0.3in}

\raggedright

\usepackage{tikz}
\usetikzlibrary{arrows}

\usepackage[]{pdfpages}
% \sincludepdf command sets common options for \includepdf
\newcommand{\sincludepdf}[2][]{
	\includepdf[scale=0.8,pagecommand={},#1]{#2}
}

\usepackage{titlesec}
\setcounter{secnumdepth}{4}

% For fourth level headers, use \paragraph
\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\begin{document}

% {{{ title page

\vspace*{0.5in}

\centerline{\LARGE \textbf{Control System Design}}
\vspace{0.2in}

\begin{center}
\begin{tabular}{c}
Jeremiah Mahler \texttt{<jmmahler@gmail.com>} \\
\today
\end{tabular}
\end{center}

\thispagestyle{empty}
\vfill
\pagebreak

% }}}

\tableofcontents

\clearpage

\section{Introduction}

This document is a collection of notes on control system design.
The author collected this information while taking two control systems
classes at California State University Chico taught by Dr. Adel Ghandakly.
The first was an introduction to control systems (EECE 482) and
the second was an advanced control systems engineering (EECE 682).
The former focused on continuous systems whereas the latter was on
discrete.

Many of the examples are hand written and place in line.
It would be nice to have these properly formatted in \LaTeX but
for the time being hand written is more expedient.

% {{{ Common Plants/Systems
\section{Common Plants/Systems}

\nocite{ogata1995discrete}
\nocite{franklin1998digital}

Plants denoted by $G(s)$ and systems by $H(s)$.

\begin{align*}
	G(s) &= \frac{1}{s^2} & \mbox{(Double Integrator)}\\
	G(s) &= \frac{1}{(s + 1)^2} \\
	H(s) &= \frac{1 + 10s}{1 + s} \\
	G(s) &= \frac{a}{s(s + a)} \\
	G(s) &= \frac{1}{s(s + 1)} \\
	G(s) &= \frac{1}{s(s + 0.4)} \\
	G(s) &= \frac{10}{s^2 + s + 1} \\
	G(s) &= \frac{10}{(s + 0.1)(s + 0.2)} \\
	H(s) &= \frac{20}{s^2 + 4s + 20} & \mbox{(from specs: $Tr = 0.5$, $\%OS = 25$)}
\end{align*}

% }}}

\clearpage
\section{Continuous}

\sincludepdf[pages={1},
		pagecommand=\subsection{Laplace Transform}\subsubsection*{Example 1}
	]{scan/11211301.pdf}

\subsection{Second Order System From Specifications}

\begin{align}
	H(s) &= \frac{\omega_n^2}{s^2 + 2 \zeta \omega_n s + \omega_n^2}
\end{align}

There are different ways to find $\omega_n$ and $\zeta$.
The following specs for the rise time ($T_r$), over shoot ($\%OS$),
and setting time ($T_s$) are one example.
\begin{align*}
	T_r &= \frac{2.22}{\omega_n} \\
	\%OS &= \left( 1 - \frac{\zeta}{0.6} \right) \cdot 100 \\
	T_s &= \frac{4}{\zeta \omega_n}
\end{align*}

\sincludepdf[pages={3},
			pagecommand=\subsubsection*{Example 1}
		]{scan/11221301.pdf}

% {{{ Pole Placement, Polynomial Matchin, Example 1
\sincludepdf[pages={4},
			pagecommand=\subsection{Pole Placement, Polynomial Matching}\subsubsection*{Example 1}
		]{scan/11221301.pdf}

The response of this system is show in Figure \ref{fig:pps2s4_plot}.
The Matlab code used to produce this plot is shown
in Listing \ref{lst:pps2s4_plot}.

\begin{figure}[h!]
\begin{center}
\includegraphics[scale=0.6]{../pole_placement_cont/pps2s4_plot}
\end{center}
\caption{Response of controller in continuous domain using Pole Placement.}
\label{fig:pps2s4_plot}
\end{figure}

\lstinputlisting[
	caption={Matlab script to plot response of Pole Place controller.},
	label=lst:pps2s4_plot,
]{../pole_placement_cont/pps2s4_plot.m}
% }}}

% {{{ Example 2
\sincludepdf[pages={2},
			pagecommand=\paragraph{Example 2}
	]{scan/11231301.pdf}
\sincludepdf[pages={3}]{scan/11231301.pdf}

The response of this system is show in Figure \ref{fig:pps2s4_plot}.
The Matlab code used to produce this plot is shown
in Listing \ref{lst:pps2s4_plot}.

\begin{figure}[h!]
\begin{center}
\includegraphics[scale=0.6]{../pole_placement_cont/pps2s1_plot}
\end{center}
\caption{Response of controller in continuous domain using Pole Placement.}
\label{fig:pps2s4_plot}
\end{figure}

\lstinputlisting[
	caption={Matlab script to plot response of Pole Place controller.},
	label=lst:pps2s1_plot,
]{../pole_placement_cont/pps2s1_plot.m}
% }}}

% {{{ Example 3
\sincludepdf[pages={4},
			pagecommand=\paragraph{Example 3}
	]{scan/11231301.pdf}

The response of this system is show in Figure \ref{fig:pps2s1a_plot}.
The Matlab code used to produce this plot is shown
in Listing \ref{lst:pps2s1a_plot}.

\begin{figure}[h!]
\begin{center}
\includegraphics[scale=0.6]{../pole_placement_cont/pps2s1a_plot}
\end{center}
\caption{Response of controller in continuous domain found using algebraic methods.}
\label{fig:pps2s1a_plot}
\end{figure}

\lstinputlisting[
	caption={Matlab script to plot response of Pole Place controller.},
	label=lst:pps2s1a_plot,
]{../pole_placement_cont/pps2s1a_plot.m}
% }}}

\clearpage
\subsection{Pole Placement, Diophantine}

\subsection{Steady State Performance (Error)}

% {{{ PID Controller Design

\sincludepdf[pages={5},
			pagecommand=\subsection{PID Controller Design}\subsubsection*{Example 1}
		]{scan/11221301.pdf}

The response of this system is show in Figure \ref{fig:pids2s4_plot}.
The Matlab code used to produce this plot is shown
in Listing \ref{lst:pids2s4_plot}.

\begin{figure}[h!]
\begin{center}
\includegraphics[scale=0.6]{../pid_cont/pids2s4_plot}
\end{center}
\caption{Response of PID controller.}
\label{fig:pids2s4_plot}
\end{figure}

\lstinputlisting[
	caption={Matlab script to plot response of PID controller.},
	label=lst:pids2s4_plot,
]{../pid_cont/pids2s4_plot.m}

% }}}

% {{{ State Space to Transfer Function (S-domain)
\sincludepdf[pages={2},
			pagecommand=\subsection{State Space to Transfer Function (S-domain)}\subsubsection*{Example 1}
	]{scan/11211301.pdf}
\sincludepdf[pages={3},
		pagecommand={}
	]{scan/11211301.pdf}

% }}}

% {{{ Transfer Function (S-domain) to State Space

\clearpage
\sincludepdf[pages={4},
			pagecommand=\subsection{Transfer Function (S-domain) to State Space}\subsubsection*{Example 1}
		]{scan/11211301.pdf}
\sincludepdf[pages={5}]{scan/11211301.pdf}

% }}}

\section{Digital}

\subsection{Z-transform}

\begin{align}
	X(z) = \sum_{n = -\infty}^{\infty} x(n) z^{-n}
\end{align}

\sincludepdf[pages={6},
		pagecommand=\subsubsection*{Example 1}
	]{scan/11211301.pdf}

\sincludepdf[pages={7},
		pagecommand=\subsection{Geometric Series}
	]{scan/11211301.pdf}

\subsection{S-domain to Z-domain}
%\subsection{Design by Z-Domain Equivalents}

When designing by discrete equivalents the design is performed
in the continuous domain and then converted to the discrete domain.
This is in contrast to Direct Design (Section \ref{sec:dd}) where
the designed is performed in the discrete domain.

To check stability, entire system must be in Z-domain.

\sincludepdf[pages={10},
			pagecommand=\subsubsection{Mapping: $z=e^{sT}$}\subsubsection*{Example 1}
		]{scan/11221301.pdf}

\sincludepdf[pages={1},
			pagecommand=\paragraph{Example 2}
	]{scan/11231301.pdf}

\sincludepdf[pages={9},
			pagecommand=\subsubsection{Mapping: Forward, Backward, Trapezoid}\paragraph{Example 1}
	]{scan/11211301.pdf}

\sincludepdf[pages={10},
			pagecommand=\paragraph{Example 2}
	]{scan/11211301.pdf}

\sincludepdf[pages={8},
			pagecommand=\subsubsection*{Example 3}
		]{scan/11221301.pdf}

\sincludepdf[pages={9},
			pagecommand=\subsubsection*{Example 4}
		]{scan/11221301.pdf}

\subsubsection{Digital PID, Ghandakly's Method}

\subsection{Analytic Design Method ($K_v$)}

The Analytical Design Method\autocite[Pg. 242]{ogata1995discrete}
is unique in that it minimizes the steady state
error for both a step and a ramp input.


% {{{ Algorithm (Z-Domain) to Difference Equation
\subsection{Algorithm (Z-Domain) to Difference Equation}

\sincludepdf[pages={11},
			pagecommand=\subsubsection*{Example 1}
		]{scan/11211301.pdf}

\sincludepdf[pages={12},
			pagecommand=\subsubsection*{Example 2}
		]{scan/11211301.pdf}

\sincludepdf[pages={13},
			pagecommand=\subsubsection*{Example 3}
		]{scan/11211301.pdf}
% }}}

% {{{ Diophantine Equation
\subsection{Diophantine Equation}

The Diophantine Equation is used to find a solution to a system
if it is in a very specific form (Equation \ref{eq:diophantine}).
For more information refer to Ogata\autocite[Pg. 525]{ogata1995discrete}
where this method is called the ``Polynomial Equations Approach''.

\begin{align}
	\alpha(z)A(z) + \beta(z)B(z) &= D \label{eq:diophantine}
\end{align}

Where $D$ is the characteristic polynomial.
Typically, $A(z)$ and $B(z)$ are known and $\alpha(z)$ and $\beta(z)$
are to be found.
Each element must have a specific order as shown below.
The order ($n$) will correspond to the order of the
Sylvester Matrix (Section \ref{sec:sylvester}).

\[
\begin{array}{ccccccc}
	\alpha(z) &A(z) &+ &\beta(z) &B(z) &= &D \\
	  (n-1)   &(n)  &  & (n-1)  &(n) & &(2n-1)
\end{array}
\]

When $A(z)$ and $B(z)$ are known $\alpha(z)$ and $\beta(z)$
can be found using Equation \ref{eq:diopmat}.

\begin{align}
	M &= E^{-1} D \label{eq:diopmat} \\
%	M &:
%	\left[
%	\begin{array}{l}
%		\alpha \\
%		\beta
%	\end{array}
%	\right] \notag \\
	\left[
	\begin{array}{l}
		\alpha \\
		\beta
	\end{array}
	\right] &= E^{-1} D \notag
\end{align}

\subsubsection{Sylvester Matrix}
\label{sec:sylvester}

Second Order
\[
E=
\begin{bmatrix}
	a_2 & 0 & b_2 & 0 \\
	a_1 & a_2 & b_1 & b_2 \\
	a_0 & a_1 & b_0 & b_1 \\
	0 & a_0 & 0 & b_0 \\
\end{bmatrix}
\]

Third Order
\[
E=
\begin{bmatrix}
	a_3 & 0 & 0 & b_3 & 0 & 0 \\
	a_2 & a_3 & 0 & b_2 & b_3 & 0 \\
	a_1 & a_2 & a_3 & b_1 & b_2 & b_3 \\
	a_0 & a_1 & a_2 & b_0 & b_1 & b_2 \\
	0 & a_0 & a_1 & 0 & b_0 & b_1 \\
	0 & 0 & a_0 & 0 & 0 & b_0 \\
\end{bmatrix}
\]

% }}}

% {{{ Zero Order Hold
\clearpage
\subsubsection{Zero Order Hold}
\label{sec:zoh}

A Zero Order Hold converts a S-domain system to the Z-domain.
It is effectively the same as putting an D/A converter before
the continuous system.
In fact this is exactly what is done in Simulink (Figure \ref{fig:simulinkzoh}).

\begin{figure}
\begin{center}
\tikzstyle{block}=[draw,minimum size=2.4em]
\tikzstyle{sum}=[draw,circle,minimum size=1.2em]
%\tikzstyle{init} = [pin edge={to-,thin,black}]
\begin{tikzpicture}[node distance=2.0cm,auto,>=latex']

	% place all the block, points, relative to each other
	\node [coordinate,node distance=2cm] (u) {};
	\node [block,right of=u] (da) {$D/A$};
	\node [coordinate,right of=da,node distance=2cm] (d) {};
	\node [block,right of=da] (g) {$G(s)$};
	\node [coordinate,right of=g,node distance=2cm] (y) {};

	\node [block,below of=d] (gz) {$G(z)$};
	\node [coordinate,below of=u,node distance=2cm] (uz) {};
	\node [coordinate,below of=y,node distance=2cm] (yz) {};

	% connect all the nodes and points
	\path[->] (u) edge node {} (da);
	\path[->] (da) edge node {} (g);
	\path[->] (g) edge node {} (y);

	\path[->] (uz) edge node {} (gz);
	\path[->] (gz) edge node {} (yz);

\end{tikzpicture}
\end{center}

\caption{A Zero Order Hold in Simulink created by preceding
a $G(s)$ system with a D/A converter to produce a $G(z)$ system.}
\label{fig:simulinkzoh}
\end{figure}

\begin{align}
	G(z) &= (1 - z^{-1}) Z \left[ \frac{G(s)}{s} \right]
\end{align}

\begin{lstlisting}
% Matlab
Gs = tf(Bs, As);
Gz = c2d(Gs, T, 'ZOH');
\end{lstlisting}

\sincludepdf[pages={8},
			pagecommand=\paragraph{Example 1}
	]{scan/11211301.pdf}

\sincludepdf[pages={6},
			pagecommand=\subsubsection*{Example 2}
		]{scan/11221301.pdf}
\sincludepdf[pages={7}]{scan/11221301.pdf}

\sincludepdf[pages={1},
			pagecommand=\subsubsection*{Example 3}
		]{scan/11221301.pdf}
\sincludepdf[pages={2}]{scan/11221301.pdf}


% }}}

% {{{ Direct Design
\clearpage
\subsection{Direct Design ($K$)}
\label{sec:dd}

% {{{ dd figure
\begin{figure}[h!]

\begin{center}
\tikzstyle{block}=[draw,minimum size=2.4em]
\tikzstyle{sum}=[draw,circle,minimum size=1.2em]
%\tikzstyle{init} = [pin edge={to-,thin,black}]
\begin{tikzpicture}[node distance=2.0cm,auto,>=latex']

	% place all the block, points, relative to each other
	\node [coordinate,node distance=2cm] (u) {u};
	\node [block,right of=u] (k) {$K$};
	\node [sum,right of=k] (s) {};
	\node [coordinate,below of=s] (ds) {ds};
	\node [block,right of=ds] (d) {$D(s)$};
	\node [block,right of=s] (g) {$G(s)$};
	\node [coordinate,right of=g] (gdy) {};
	\node [coordinate,right of=gdy,node distance=2cm] (y) {y};
	\node [coordinate,right of=d] (gd) {gd};

	% add signs to sum
	\node [left of=s,node distance=0cm,xshift=-3mm,yshift=3mm] {$+$};
	\node [left of=s,node distance=0cm,xshift=-3mm,yshift=-4mm] {$-$};

	% add labels to G(s) and D(s)
	\node [right of=g,node distance=0cm,xshift=8mm,yshift=6mm] {$\dfrac{B}{A}$};
	\node [right of=d,node distance=0cm,xshift=8mm,yshift=6mm] {$\dfrac{\beta}{\alpha}$};

	% connect all the nodes and points
	\path[->] (u) edge node {$u$} (k);
	\path[->] (k) edge node {} (s);
	\path[->] (ds) edge node {} (s);
	\path[-]  (d) edge node {} (ds);
	\path[->] (s) edge node {$\epsilon$} (g);
	\path[-] (g) edge node {} (gdy);
	\path[->] (gdy) edge node {$y$} (y);
	\path[-] (gdy) edge node {} (gd);
	\path[->] (gd) edge node {} (d);

\end{tikzpicture}
\end{center}

\caption{Direct Design system wit $K$ as a scaling input, $G$ is
the plant and $D$ (${\beta}/{\alpha}$) is the controller.}
\label{fig:dd}
\end{figure}
% }}}

A Direct Design system has several characteristics as shown
in Figure \ref{fig:dd}.
The controller ($D$) is in the feedback loop and there is a gain ($K$)
on the input.

A controller is found by first converting the plant ($G$) in to discrete form
using a Zero Order Hold (Section \ref{sec:zoh}).
Then the poles are placed according to roots given by the designer.
Roots may need to be added to correct the order so that the Diophantine
Equation can be used to find $\alpha$ and $\beta$.
Examples of this process are included below.
For a detailed examination refer to Ogata\autocite[Pg. 517]{ogata1995discrete}.

\sincludepdf[pages=1,
			pagecommand=\subsubsection*{Example: $\dfrac{1}{s^2}$}
	]{scan/11211302.pdf}
\sincludepdf[pages=2-5]{scan/11211302.pdf}

Listing \ref{lst:dd1s2_init} shows the Matlab code used to perform
these calculations.
Listing \ref{lst:dd1s2_plot} shows the Matlab code to plot the response.
Figure \ref{fig:dd1s2_plot} shows the response.
The \verb+sylvester+ function is given in Appendix \ref{app:sylvester}.

\lstinputlisting[
	caption={Matlab script to find Direct Design of double integrator.},
	label=lst:dd1s2_init,
]{../direct_design/dd1s2_init.m}

\lstinputlisting[
	caption={Matlab script to plot the response of the double integrator.},
	label=lst:dd1s2_plot,
]{../direct_design/dd1s2_plot.m}

\begin{figure}
\begin{center}
\includegraphics[scale=0.6]{../direct_design/dd1s2_plot}
\end{center}
\caption{Response of double integrator for controller built
using Direct Design. Uses a time step of 0.2 seconds.}
\label{fig:dd1s2_plot}
\end{figure}

% }}}

% {{{ Model Matching
\clearpage
\subsection{Model Matching ($G_{model}$)}
\label{sec:mm}

Controller design using Model Matching is similar to Direct Design
(Section \ref{sec:dd}) except that instead of a gain ($K$) there is
another transfer function ($G_{model}$).
For more information refer to Ogata\autocite[Pg. 532]{ogata1995discrete}.

\begin{figure}

\begin{center}
\tikzstyle{block}=[draw,minimum size=2.4em]
\tikzstyle{sum}=[draw,circle,minimum size=1.2em]
%\tikzstyle{init} = [pin edge={to-,thin,black}]
\begin{tikzpicture}[node distance=2.0cm,auto,>=latex']

	% place all the block, points, relative to each other
	\node [coordinate,node distance=2cm] (u) {u};
	\node [block,right of=u] (k) {$G_{model}$};
	\node [sum,right of=k] (s) {};
	\node [coordinate,below of=s] (ds) {ds};
	\node [block,right of=ds] (d) {$D(z)$};
	\node [block,right of=s] (g) {$G(z)$};
	\node [coordinate,right of=g] (gdy) {};
	\node [coordinate,right of=gdy,node distance=2cm] (y) {y};
	\node [coordinate,right of=d] (gd) {gd};

	% add signs to sum
	\node [left of=s,node distance=0cm,xshift=-3mm,yshift=3mm] {$+$};
	\node [left of=s,node distance=0cm,xshift=-3mm,yshift=-4mm] {$-$};

	% add labels to G(s) and D(s)
	\node [right of=g,node distance=0cm,xshift=8mm,yshift=6mm] {$\dfrac{B}{A}$};
	\node [right of=d,node distance=0cm,xshift=8mm,yshift=6mm] {$\dfrac{\beta}{\alpha}$};

	% connect all the nodes and points
	\path[->] (u) edge node {$u$} (k);
	\path[->] (k) edge node {} (s);
	\path[->] (ds) edge node {} (s);
	\path[-]  (d) edge node {} (ds);
	\path[->] (s) edge node {$\epsilon$} (g);
	\path[-] (g) edge node {} (gdy);
	\path[->] (gdy) edge node {$y$} (y);
	\path[-] (gdy) edge node {} (gd);
	\path[->] (gd) edge node {} (d);

\end{tikzpicture}
\end{center}

\caption{Model Matching system with $G_{model}$ as input. $G$ is
the plant and $D$ is the controller.}
\label{fig:mm}
\end{figure}
% }}}

\subsection{Poll Placement with Ackerman's Formula}

\subsection{State Space, Full Feedback}

Full feedback with no estimation.

\subsection{State Space, Full Order "predictor" Estimator}

Full feedback but some are estimated.

\subsection{State Space, Reduced Order Estimator}

Partial feedback with estimated.

\clearpage
\printbibliography[heading=bibintoc]

\clearpage
\appendix

\section{Sylvester Matrix Generation in Matlab}
\label{app:sylvester}

\lstinputlisting[
	caption={Matlab function to calculate a Sylvester Matrix.},
	label=lst:sylvester,
]{../direct_design/sylvester.m}


\section{Quick Reference}

\subsection{Table of Laplace and Z-transforms}

\end{document}
